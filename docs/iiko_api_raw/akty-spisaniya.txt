Акты списания

  

    

  
Акты списания
Описание полей
Выгрузка документов
Параметры запроса
Что в ответе
Пример запроса и результат
Выгрузка документа по идентификатору
Параметры запроса
Что в ответе
Пример запроса и результат
Выгрузка документов по номеру
Параметры запроса
Примеры запроса и результат
Создание/редактирование документа
Тело запроса
Пример запроса и результат 

  
  

  

Акты списания

Версия iiko: 7.9.3

     Описание полей   

  

    [+]
    
      WriteoffDocumentDto
    
  
  

    [-]
    
      WriteoffDocumentDto
    
  
  

    
  
   

  

    
      
        
        
        
      
      
        

          
            
               Поле             
          
          
            
               Тип             
          
          
            
               Описание             
          
        
      
      
        

          	             id           
          	             UUID           
          	             Идентификатор документа.           
        
        

          	             dateIncoming           
          	             String           
          	             Дата проведения документа (учетная) в формате "yyyy-MM-dd'T'HH:mm".           
        
        

          	             documentNumber           
          	             String           
          	             Учетный номер документа.           
        
        

          	             status           
          	             Enum           
          	
            
               Статус документа.             
            

              
                
                  

                    
                      
                         Значение                       
                    
                    
                      
                         Описание                       
                    
                  
                
                
                  

                    	                       NEW                     
                    	                       Новый.                     
                  
                  

                    	                       PROCESSED                     
                    	                       Проведенный.                     
                  
                  

                    	                       DELETED                     
                    	                       Удаленный.                     
                  
                
              
            
          
        
        

          	             conceptionId           
          	             UUID           
          	             Идентификатор концепции.           
        
        

          	             comment           
          	             String           
          	             Комментарий к документу.           
        
        

          	             storeId           
          	             UUID           
          	             Идентификатор склада, с которого происходит списывание.           
        
        

          	             accountId           
          	             UUID           
          	             Идентификатор счета, на который будет списана стоимость товара.           
        
        

          	             externalOutgoingInvoiceId           
          	             UUID           
          	             Идентификатор расходной накладной с externalStore, если идет списание со склада с отмеченным параметром "Списывать с внешнего склада".           
        
        

          	             externalProductionDocumentId           
          	             UUID           
          	             Идентификатор акта приготовления, если при проводке этого документа был сгенерирован акт приготовления.           
        
        

          	             items           
          	             List<WriteoffDocumentItemDto>           
          	             Позиции документа.           
        
      
    
  
  
     

  

  

  
[+]
    
      WriteoffDocumentItemDto
    
  
  

    [-]
    
      WriteoffDocumentItemDto
    
  
  

   

  

    
      
        
        
        
      
      
        

          
            
               Поле             
          
          
            
               Тип             
          
          
            
               Описание             
          
        
      
      
        

          	             num           
          	             Integer           
          	             Позиция строки в документе. При создании/редактировании приказа не учитывается.           
        
        

          	             productId           
          	             UUID           
          	             Идентификатор продукта.           
        
        

          	             productSizeId           
          	             UUID           
          	             Идентификатор размера продукта.           
        
        

          	             amountFactor           
          	             BigDecimal           
          	             Коэффициент списания.           
        
        

          	             amount           
          	             BigDecimal           
          	             Количество продукта в единицах измерения продукта.           
        
        

          	             measureUnitId           
          	             UUID           
          	             Единицы измерения продукта на момент списания.           
        
        

          	             containerId           
          	             UUID           
          	             Идентификатор фасовки продукта.           
        
        

          	             cost           
          	             BigDecimal           
          	             Себестоимость для данного количества продукта. Только чтение.
        
      
    
  
  

  
Выгрузка документов

  
    
	
        
      	https://host:port/resto/api/v2/documents/writeoff
    
  

Параметры запроса

              
                
                  

                    
                      
Параметр                       
                    
                    
                      
                         Тип                       
                    
                    
                      
                         Описание                       
                    
                  
                
                
                  

                    	                       dateFrom                     
                    	                       String                     
                    	                       Начало временного интервала в формате "yyyy-MM-dd". Обязательный.                     
                  
                  

                    	                       dateTo                     
                    	                       String                     
                    	                       Конец временного интервала в формате "yyyy-MM-dd". Обязательный.                     
                  
                  

                    	                       status                     
                    	                       Enum                     
                    	                       Статус документа. Если не задан, то все.                     
                  
                  

                    	                       revisionFrom                     
                    	                       Integer                     
                    	                       В ответе будут сущности с ревизией выше данной. По умолчанию '-1'.                     
                  
                
              
            
Что в ответе

            
Список документов.             
            
               Поле revision - максимальная ревизия, доступная для выгрузки во внешние системы на момент запроса (это значит, что в базе присутствуют записи с такой ревизией, а записей с ревизией выше этой в базе нет).             
            
               Эту ревизию можно использовать в качестве параметра revisionFrom в следующем запросе на получение списка расписаний.
          
Пример запроса и результат

Запрос

https://localhost:9080/resto/api/v2/documents/writeoff?dateFrom=2018-01-01&dateTo=2021-12-31

  

    [+]
    
      Результат
    
  
  

    [-]
    
     Результат
    
  
  

     
	
Copy Code
JSON
	{
  "result": "SUCCESS",
  "errors": [
  ],
  "response": [
    {
      "id": "3d27d640-d6a1-4545-86a4-b07422c3c9f0",
      "dateIncoming": "2020-01-10T23:00",
      "documentNumber": "20002",
      "status": "PROCESSED",
      "storeId": "7954d76d-6177-402c-ba2a-cc0ff16486fa",
      "accountId": "97036ddb-b2e1-cd47-1669-c145daa9f9c5",
      "items": [
        {
          "num": 1,
          "productId": "31e6155c-e842-448f-8266-1d05eb8e977a",
          "productSizeId": null,
          "amountFactor": 1,
          "amount": 2,
          "measureUnitId": "6040d92d-e286-f4f9-a613-ed0e6fd241e1",
          "containerId": null,
          "cost": 0                                                        
        }
        
      ]
      
    },
    {
      "id": "0173e58c-7bcd-487d-a8ad-c8ec48c642a1",
      "dateIncoming": "2020-01-14T23:00",
      "documentNumber": "20001",
      "status": "PROCESSED",
      "storeId": "7954d76d-6177-402c-ba2a-cc0ff16486fa",
      "accountId": "8c46f55a-0698-4e3f-8703-8bb36b24e8ac",
      "items": [
        {
          "num": 1,
          "productId": "50cedffc-04e9-aa79-016b-d1f9c56122e8",
          "productSizeId": null,
          "amountFactor": 1,
          "amount": 2,
          "measureUnitId": "7ba81c3a-8de5-8f9d-fb9f-e39efcbc57cc",
          "containerId": null,
          "cost": 200                                                        
        }
        
      ]
      
    }
    
  ],
  "revision": 244610                                        
}
  

Выгрузка документа по идентификатору

  
    
	                	https://host:port/resto/api/v2/documents/writeoff/byId
    
  

Параметры запроса

                
                  

                    
                      
                         Параметр                       
                    
                    
                      
                         Тип                       
                    
                    
                      
                         Описание                       
                    
                  
                
                
                  

                    	                       id                     
                    	                       UUID                     
                    	                       Идентификатор документа.                     
                  
                
              
            
Что в ответе

Выгруженный документ
Пример запроса и результат

Запрос

https://localhost:9080/resto/api/v2/documents/writeoff/byId?id=3d27d640-d6a1-4545-86a4-b07422c3c9f0
Результат

	
Copy Code
JSON
	{
  "id": "3d27d640-d6a1-4545-86a4-b07422c3c9f0",
  "dateIncoming": "2020-01-10T23:00",
  "documentNumber": "20002",
  "status": "PROCESSED",
  "storeId": "7954d76d-6177-402c-ba2a-cc0ff16486fa",
  "accountId": "97036ddb-b2e1-cd47-1669-c145daa9f9c5",
  "items": [
    {
      "num": 1,
      "productId": "31e6155c-e842-448f-8266-1d05eb8e977a",
      "productSizeId": null,
      "amountFactor": 1,
      "amount": 2,
      "measureUnitId": "6040d92d-e286-f4f9-a613-ed0e6fd241e1",
      "containerId": null,
      "cost": 0                                                
    }
    
  ]
  
}

Выгрузка документов по номеру

  
    
	                	https://host:port/resto/api/v2/documents/writeoff/byNumber
    
  

Параметры запроса

              
                
                  

                    
                      
                         Параметр                       
                    
                    
                      
                         Тип                       
                    
                    
                      
                         Описание                       
                    
                  
                
                
                  

                    	                       documentNumber                     
                    	                       String                     
                    	                       Номер документа.                     
                  
                
              
            
Примеры запроса и результат

Запрос

https://localhost:9080/resto/api/v2/documents/writeoff/byNumber?documentNumber=20002
Результат

	
Copy Code
JSON
	[
  {
    "id": "3d27d640-d6a1-4545-86a4-b07422c3c9f0",
    "dateIncoming": "2020-01-10T23:00",
    "documentNumber": "20002",
    "status": "PROCESSED",
    "storeId": "7954d76d-6177-402c-ba2a-cc0ff16486fa",
    "accountId": "97036ddb-b2e1-cd47-1669-c145daa9f9c5",
    "items": [
      {
        "num": 1,
        "productId": "31e6155c-e842-448f-8266-1d05eb8e977a",
        "productSizeId": null,
        "amountFactor": 1,
        "amount": 2,
        "measureUnitId": "6040d92d-e286-f4f9-a613-ed0e6fd241e1",
        "containerId": null,
        "cost": 0                                                    
      }
      
    ]
    
  }
  
] 
Создание/редактирование документа

  
    
	
        
      	https://host:port/resto/api/v2/documents/writeoff

    
  

Тело запроса

              
Если задан идентификатор документа - считаем, что это редактирование (редактировать приказ можно, если его статус 'NEW'), если не задан, то создание.               
              
                 Обязательные поля: 'dateIncoming', 'status', 'storeId', 'accountId'. Также должна быть как минимум одна позиция в документе.               
              
                 Для позиций в документе обязательными являются поля 'productId', 'amount'.               
              
                 Если при создании документа не задано поле 'documentNumber', оно сгенерится автоматически.
              

	
Copy Code
JSON
	{
  "dateIncoming": "2021-11-16T23:00",
  "status": "NEW",
  "comment": "yyy",
  "storeId": "7954d76d-6177-402c-ba2a-cc0ff16486fa",
  "accountId": "8c46f55a-0698-4e3f-8703-8bb36b24e8ac",
  "items": [
    {
      "productId": "50cedffc-04e9-aa79-016b-d1f9c56122e8",
      "amount": 1                                                                        
    }
    
  ]
  
}
              

Пример запроса и результат

Запрос

https://localhost:9080/resto/api/v2/documents/writeoff
              
Результат

	
Copy Code
JSON
	{
  "result": "SUCCESS",
  "errors": [
  ],
  "response": {
    "id": "78e58a66-1648-e023-017d-28c01da501cc",
    "dateIncoming": "2021-11-16T23:00",
    "documentNumber": "",
    "status": "NEW",
    "comment": "yyy",
    "storeId": "7954d76d-6177-402c-ba2a-cc0ff16486fa",
    "accountId": "8c46f55a-0698-4e3f-8703-8bb36b24e8ac",
    "items": [
      {
        "num": 1,
        "productId": "50cedffc-04e9-aa79-016b-d1f9c56122e8",
        "productSizeId": null,
        "amountFactor": 1,
        "amount": 1,
        "measureUnitId": "6040d92d-e286-f4f9-a613-ed0e6fd241e1",
        "containerId": null,
        "cost": null                                                                            
      }
      
    ]
    
  }
  
}