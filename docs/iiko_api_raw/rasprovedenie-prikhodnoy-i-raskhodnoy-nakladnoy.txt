Распроведение приходной и расходной накладной

  

    

  
Распроведение приходной накладной
Тело запроса
Что в ответе
Распроведение расходной накладной
Тело запроса
Что в ответе
XSD Приходная накладная
XSD Расходная накладная
*XSD Результат валидации документа​ 

  
  

  

Распроведение приходной накладной

Версия iiko: 7.7
  
    
	
        
      	
        
        
https://host:port/resto/api/documents/unprocess/incomingInvoice
      
      
    
  

Тело запроса

Структура document (см. XSD Приходная накладная)

Что в ответе

Структура documentValidationResult (см. XSD Результат валидации документа)

Распроведение расходной накладной

Версия iiko: 7.7
  
    
	                	
        
        
https://host:port/resto/api/documents/unprocess/outgoingInvoice
      
      
    
  

Тело запроса

Структура outgoingInvoiceDto (см. XSD Расходная накладная)

Что в ответе

Структура documentValidationResult (см. XSD Результат валидации документа)

XSD Приходная накладная 

	
  

    Copy Code
XML
	
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="document" type="incomingInvoiceDto"/>
 
    <xs:complexType name="incomingInvoiceDto">
        <xs:sequence>
            <!--Позиции документа-->
            <xs:element name="items" minOccurs="0">
                <xs:complexType>
                    <xs:sequence>
                        <xs:element name="item" type="incomingInvoiceItemDto" minOccurs="0" maxOccurs="unbounded"/>
                    </xs:sequence>
                </xs:complexType>
            </xs:element>
            <!--
            Id документа (только чтение)
            @since 5.4
            -->
            <xs:element name="id" type="xs:string" minOccurs="0"/>
            <!--Концепция (guid)-->
            <xs:element name="conception" type="xs:string" minOccurs="0"/>
            <!--
            Код концепции.
            @since 7.8
            -->
            <xs:element name="conceptionCode" type="xs:string" minOccurs="0"/>
            <!--Комментарий-->
            <xs:element name="comment" type="xs:string" minOccurs="0"/>
            <!--Учетный номер документа-->
            <xs:element name="documentNumber" type="xs:string" minOccurs="0"/>
            <!--
            Дата документа.
            Поддерживаемые форматы:
            yyyy-MM-ddTHH:mm:ss, yyyy-MM-dd (dd.MM.yyyy не рекомендуется).
            -->
            <xs:element name="dateIncoming" type="xs:string" minOccurs="0"/>
            <!--Номер счет-фактуры.-->
            <xs:element name="invoice" type="xs:string" minOccurs="0"/>
            <!--Склад. Если указан, то в каждой позиции накладной нужно указать этот же склад.-->
            <xs:element name="defaultStore" type="xs:string" minOccurs="0"/>
            <!--Поставщик-->
            <xs:element name="supplier" type="xs:string" minOccurs="0"/>
            <!--
            Срок оплаты.
            Поддерживаемые форматы:
            yyyy-MM-ddTHH:mm:ss (dd.MM.yyyy не рекомендуется)
            -->
            <xs:element name="dueDate" type="xs:string" minOccurs="0"/>
            <!--
            Входящая дата внешнего документа в формате yyyy-MM-dd.
            Если при импорте не указана, то берется из dateIncoming.
            @since 7.6.1
            -->
            <xs:element name="incomingDate" type="xs:string" minOccurs="0"/>
            <!--
            false (по умолчанию): использовать переданные дату-время dateIncoming как есть.
            true: использовать настройки проведения документов, заданные в подразделении:
             * В режиме "текущее время" - дату и время из dateIncoming;
             * "фиксированное время" или "время закрытия кассовой смены" - дату из dateIncoming, а время из настроек.
            @since 5.2
            -->
            <xs:element name="useDefaultDocumentTime" type="xs:boolean" minOccurs="0" default="false"/>
            <xs:element name="status" type="documentStatus" minOccurs="0"/>
            <!--Входящий номер внешнего документа-->
            <xs:element name="incomingDocumentNumber" type="xs:string" minOccurs="0"/>
            <!--Сотрудник (поле "зачесть сотруднику" на форме накладной)-->
            <xs:element name="employeePassToAccount" type="xs:string" minOccurs="0"/>
            <!--Номер товарно-транспортной накладной-->
            <xs:element name="transportInvoiceNumber" type="xs:string" minOccurs="0"/>
            <!--
            UUID связанной расходной накладной
            (только чтение)
            @since 5.4
            -->
            <xs:element name="linkedOutgoingInvoiceId" type="xs:string" minOccurs="0"/>
             
            <!--
            Алгоритм распределения дополнительных расходов.
            (только чтение)
            @since 6.0
            -->
            <xs:element name="distributionAlgorithm" type="distributionAlgorithmType" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
 
    <!--Позиция документа-->
    <xs:complexType name="incomingInvoiceItemDto">
        <xs:sequence>
            <!--
            Является дополнительным расходом
            (только чтение)
            @since 6.0
            -->
            <xs:element name="isAdditionalExpense" type="xs:boolean" minOccurs="0" default="false"/>
             <!--Количество товара в его основных единицах измерения-->
            <xs:element name="amount" type="xs:decimal" minOccurs="0"/>
            <!--Товар у поставщика (guid)-->
            <xs:element name="supplierProduct" type="xs:string" minOccurs="0"/>
            <!--Товар у поставщика (артикул). Можно задать вместо guid начиная с 5.0.-->
            <xs:element name="supplierProductArticle" type="xs:string" minOccurs="0"/>
            <!--Товар (guid). Хотя бы одно из полей должно быть заполнено: product или productArticle.-->
            <xs:element name="product" type="xs:string" minOccurs="0"/>
            <!--Товар (артикул). Можно задать вместо guid товара начиная с 5.0, guid имеет приоритет.-->
            <xs:element name="productArticle" type="xs:string" minOccurs="0"/>
            <!--Производитель/импортер. Должен содержаться в списке производителей/импортеров в карточке товара:
            Товар - Дополнительная информация - Акогольная декларация - Производитель/Импортер-->
            <xs:element name="producer" type="xs:string" minOccurs="0"/>
            <!--Номер позиции в документе. Обязательное поле.-->
            <xs:element name="num" type="xs:int" minOccurs="1"/>
            <!--Фасовка (guid)-->
            <xs:element name="containerId" type="xs:string" minOccurs="0"/>
            <!--Базовая единица измерения (guid)-->
            <xs:element name="amountUnit" type="xs:string" minOccurs="0"/>
            <!--Вес единицы измерения-->
            <!--!!! Не реализовано !!!-->
            <xs:element name="actualUnitWeight" type="xs:decimal" minOccurs="0"/>
            <!--
            Cумма строки без учета скидки.
            Как правило sum == amount * price / container + discountSum + vatSum
             -->
            <xs:element name="sum" type="xs:decimal" minOccurs="1"/>
            <!--Cумма скидки-->
            <!--!!! Не реализовано !!!-->
            <xs:element name="discountSum" type="xs:decimal" minOccurs="0"/>
            <!--
            Величина процента НДС и сумма НДС для строки документа.
            Если не задана сумма, она вычисляется по проценту.
            Если не задан процент, он берется из карточки товара.
            Нельзя задать только сумму, не задавая процент.
            @since 5.0
            -->
            <xs:element name="vatPercent" type="xs:decimal" minOccurs="0"/>
            <xs:element name="vatSum" type="xs:decimal" minOccurs="0"/>
            <!--Цена единицы измерения-->
            <xs:element name="priceUnit" type="xs:string" minOccurs="0"/>
            <!--Цена за ед.-->
            <xs:element name="price" type="xs:decimal" minOccurs="0"/>
            <!--
            Цена без НДС за фасовку с учетом скидки
            @since 6.2
            -->
            <xs:element name="priceWithoutVat" type="xs:decimal" minOccurs="0"/>
            <!--Код-->
            <!--!!! Не реализовано !!!-->
            <xs:element name="code" type="xs:string" minOccurs="0"/>
            <!--Склад-->
            <xs:element name="store" type="xs:string" minOccurs="0"/>
            <!--Номер государственной таможенной декларации-->
            <xs:element name="customsDeclarationNumber" type="xs:string" minOccurs="0"/>
            <!--Фактическое (подтвержденное) количество основных единиц товара-->
            <xs:element name="actualAmount" type="xs:decimal" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
 
    <xs:simpleType name="documentStatus">
        <xs:restriction base="xs:string">
            <xs:enumeration value="NEW"/>
            <xs:enumeration value="PROCESSED"/>
            <xs:enumeration value="DELETED"/>
        </xs:restriction>  
    </xs:simpleType>
     
    <xs:simpleType name="distributionAlgorithmType">
        <xs:restriction base="xs:string">
            <xs:enumeration value="DISTRIBUTION_BY_SUM"/>
            <xs:enumeration value="DISTRIBUTION_BY_AMOUNT"/>
            <xs:enumeration value="DISTRIBUTION_NOT_SPECIFIED"/>
        </xs:restriction>
    </xs:simpleType>
</xs:schema>

XSD Расходная накладная 

	
Copy Code
XML
	
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="document" type="outgoingInvoiceDto"/>
 
    <xs:complexType name="outgoingInvoiceDto">
        <xs:sequence>
            <!--
            Id документа(только чтение)
            @since 5.4
            -->
            <xs:element name="id" type="xs:string" minOccurs="0"/>
            <xs:element name="documentNumber" type="xs:string" minOccurs="0"/>
            <!--
            Учетная дата-время документа.
            Если не заполнено, используется дата-время сервера.
            Поддерживаемые форматы:
            yyyy-MM-ddTHH:mm:ss, yyyy-MM-dd (dd.MM.yyyy не рекомендуется).
            -->
            <xs:element name="dateIncoming" type="xs:dateTime" minOccurs="0"/>
            <!--
            false (по умолчанию): использовать переданные дату-время dateIncoming как есть.
            true: использовать настройки проведения документов, заданные в подразделении:
             * В режиме "текущее время" - дату и время из dateIncoming;
             * "фиксированное время" или "время закрытия кассовой смены" - дату из dateIncoming, а время из настроек.
            -->
            <xs:element name="useDefaultDocumentTime" type="xs:boolean" minOccurs="0" default="false"/>
            <xs:element name="status" type="documentStatus" minOccurs="0"/>
            <!-- Счет для списания товаров (расходный счет). По умолчанию "5.01" ("Расход продуктов"). -->
            <xs:element name="accountToCode" type="xs:string" minOccurs="0"/>
            <!-- Счет выручки. По умолчанию "4.01" ("Торговая выручка"). -->
            <xs:element name="revenueAccountCode" type="xs:string" minOccurs="0"/>
            <!--
            Склад (id или код). При создании накладных с проведением обязателен.
            Заполняется либо в документе, либо в каждой строке отдельно, но не одновременно.
            Если заполнен в документе, в бекофисе будет отмечена галочка "Отгрузить со склада".
            -->
            <xs:element name="defaultStoreId" type="xs:string" minOccurs="0"/>
            <xs:element name="defaultStoreCode" type="xs:string" minOccurs="0"/>
            <!-- Контрагент -->
            <xs:element name="counteragentId" type="xs:string" minOccurs="0"/>
            <xs:element name="counteragentCode" type="xs:string" minOccurs="0"/>
            <!-- Концепция -->
            <xs:element name="conceptionId" type="xs:string" minOccurs="0"/>
            <xs:element name="conceptionCode" type="xs:string" minOccurs="0"/>
            <!-- Комментарий -->
            <xs:element name="comment" type="xs:string" minOccurs="0"/>
            <!--
            UUID связанной расходной накладной
            (только чтение)
            @since 5.4
            -->
            <xs:element name="linkedOutgoingInvoiceId" type="xs:string" minOccurs="0"/>
            <xs:element name="items">
                <xs:complexType>
                    <xs:sequence>
                        <xs:element name="item" type="outgoingInvoiceItemDto" minOccurs="0" maxOccurs="unbounded"/>
                    </xs:sequence>
                </xs:complexType>
            </xs:element>
        </xs:sequence>
    </xs:complexType>
 
    <xs:complexType name="outgoingInvoiceItemDto">
        <xs:sequence>
            <!-- Элемент номенклатуры (id или код (артикул))-->
            <xs:element name="productId" type="xs:string" minOccurs="0"/>
            <xs:element name="productArticle" type="xs:string" minOccurs="0"/>
            <!--
            Склад (id или код). При создании накладных с проведением обязателен.
            Заполняется либо в документе, либо в каждой строке отдельно, но не одновременно.
            -->
            <xs:element name="storeId" type="xs:string" minOccurs="0"/>
            <xs:element name="storeCode" type="xs:string" minOccurs="0"/>
            <!-- Фасовка (id или код(артикул)) -->
            <xs:element name="containerId" type="xs:string" minOccurs="0"/>
            <xs:element name="containerCode" type="xs:string" minOccurs="0"/>
            <!-- Цена за фасовку с учетом скидки -->
            <xs:element name="price" type="xs:decimal" minOccurs="1"/>       
            <!--
            Цена без НДС за фасовку с учетом скидки
            (только чтение)
            @since 6.2
            -->
            <xs:element name="priceWithoutVat" type="xs:decimal" minOccurs="0"/>
            <!-- Количество в базовых единицах измерения -->
            <xs:element name="amount" type="xs:decimal" minOccurs="1"/>
            <!--
            Cумма строки без учета скидки.
            Как правило sum == amount * price / container + discountSum + vatSum
             -->
            <xs:element name="sum" type="xs:decimal" minOccurs="1"/>
            <!-- Cумма скидки -->
            <xs:element name="discountSum" type="xs:decimal" minOccurs="0"/>
            <!--
            Величина процента НДС и сумма НДС для строки документа.
            Если не задана сумма, она вычисляется по проценту.
            Если не задан процент, он берется из карточки товара.
            Нельзя задать только сумму, не задавая процент.
            @since 5.0
             -->
            <xs:element name="vatPercent" type="xs:decimal" minOccurs="0"/>
            <xs:element name="vatSum" type="xs:decimal" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
 
    <xs:simpleType name="documentStatus">
        <xs:restriction base="xs:string">
            <xs:enumeration value="NEW"/>
            <xs:enumeration value="PROCESSED"/>
            <xs:enumeration value="DELETED"/>
        </xs:restriction>
    </xs:simpleType>
</xs:schema>

*XSD Результат валидации документа​

	
Copy Code
XML
	
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="documentValidationResult" type="documentValidationResult"/>
 
    <!--
    Результат валидации документа.
    Некоторые документы возвращают более подробную информацию, смотрите:
     * incomingInventoryValidationResult.xsd
    -->
    <xs:complexType name="documentValidationResult">
        <xs:sequence>
            <!-- Результат валидации. -->
            <xs:element name="valid" type="xs:boolean"/>
            <!-- Указывает на то, что ошибка не критичная и служит в качестве предупреждения. -->
            <xs:element name="warning" type="xs:boolean"/>
            <!-- Номер валидируемого документа. -->
            <xs:element name="documentNumber" type="xs:string" minOccurs="0"/>
            <!--
            Новый номер для документа.
            Отличен от null, если старый нарушает уникальность или не изменились влияющие на номер поля.
            -->
            <xs:element name="otherSuggestedNumber" type="xs:string" minOccurs="0"/>
            <!--
            Текст ошибки (или только заголовок, если задано additionalInfo).
            Предназначен для показа пользователю, но в REST API не всегда локализован.
            -->
            <xs:element name="errorMessage" type="xs:string" minOccurs="0"/>
            <!--
            Для невалидного результата может быть указана дополнительная информация, содержащая детали ошибки.
            Например, для случая списания в минус это поле содержит детальную информацию по каждой позиции документа,
            приводящей к отрицательным остаткам.
            -->
            <xs:element name="additionalInfo" type="xs:string" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
</xs:schema>