Загрузка и редактирование расходной накладной

  

    

  
Тело запроса
Что в ответе
Пример запроса и результат 

  
  

  

Версия iiko: 4.4
  
    
	
        
      	
        
https://host:port/resto/api/documents/import/outgoingInvoice
      
    
  

Content-Type: application/xml
Тело запроса

Структура outgoingInvoiceDto 

                    

  

    [+]
    
      XSD Расходная накладная
    
  
  

    [-]
    
      XSD Расходная накладная
    
  
  

     
	
Copy Code
XML
	<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="document" type="outgoingInvoiceDto"/>
 
    <xs:complexType name="outgoingInvoiceDto">
        <xs:sequence>
            <!--
            Id документа(только чтение)
            @since 5.4
            -->
            <xs:element name="id" type="xs:string" minOccurs="0"/>
            <xs:element name="documentNumber" type="xs:string" minOccurs="0"/>
            <!--
            Учетная дата-время документа.
            Если не заполнено, используется дата-время сервера.
            Поддерживаемые форматы:
            yyyy-MM-ddTHH:mm:ss, yyyy-MM-dd (dd.MM.yyyy не рекомендуется).
            -->
            <xs:element name="dateIncoming" type="xs:dateTime" minOccurs="0"/>
            <!--
            false (по умолчанию): использовать переданные дату-время dateIncoming как есть.
            true: использовать настройки проведения документов, заданные в подразделении:
             * В режиме "текущее время" - дату и время из dateIncoming;
             * "фиксированное время" или "время закрытия кассовой смены" - дату из dateIncoming, а время из настроек.
            -->
            <xs:element name="useDefaultDocumentTime" type="xs:boolean" minOccurs="0" default="false"/>
            <xs:element name="status" type="documentStatus" minOccurs="0"/>
            <!-- Счет для списания товаров (расходный счет). По умолчанию "5.01" ("Расход продуктов"). -->
            <xs:element name="accountToCode" type="xs:string" minOccurs="0"/>
            <!-- Счет выручки. По умолчанию "4.01" ("Торговая выручка"). -->
            <xs:element name="revenueAccountCode" type="xs:string" minOccurs="0"/>
            <!--
            Склад (id или код). При создании накладных с проведением обязателен.
            Заполняется либо в документе, либо в каждой строке отдельно, но не одновременно.
            Если заполнен в документе, в бекофисе будет отмечена галочка "Отгрузить со склада".
            -->
            <xs:element name="defaultStoreId" type="xs:string" minOccurs="0"/>
            <xs:element name="defaultStoreCode" type="xs:string" minOccurs="0"/>
            <!-- Контрагент -->
            <xs:element name="counteragentId" type="xs:string" minOccurs="0"/>
            <xs:element name="counteragentCode" type="xs:string" minOccurs="0"/>
            <!-- Концепция -->
            <xs:element name="conceptionId" type="xs:string" minOccurs="0"/>
            <xs:element name="conceptionCode" type="xs:string" minOccurs="0"/>
            <!-- Комментарий -->
            <xs:element name="comment" type="xs:string" minOccurs="0"/>
            <!--
            UUID связанной расходной накладной
            (только чтение)
            @since 5.4
            -->
            <xs:element name="linkedOutgoingInvoiceId" type="xs:string" minOccurs="0"/>
            <xs:element name="items">
                <xs:complexType>
                    <xs:sequence>
                        <xs:element name="item" type="outgoingInvoiceItemDto" minOccurs="0" maxOccurs="unbounded"/>
                    </xs:sequence>
                </xs:complexType>
            </xs:element>
        </xs:sequence>
    </xs:complexType>
 
    <xs:complexType name="outgoingInvoiceItemDto">
        <xs:sequence>
            <!-- Элемент номенклатуры (id или код (артикул))-->
            <xs:element name="productId" type="xs:string" minOccurs="0"/>
            <xs:element name="productArticle" type="xs:string" minOccurs="0"/>
            <!--
            Склад (id или код). При создании накладных с проведением обязателен.
            Заполняется либо в документе, либо в каждой строке отдельно, но не одновременно.
            -->
            <xs:element name="storeId" type="xs:string" minOccurs="0"/>
            <xs:element name="storeCode" type="xs:string" minOccurs="0"/>
            <!-- Фасовка (id или код(артикул)) -->
            <xs:element name="containerId" type="xs:string" minOccurs="0"/>
            <xs:element name="containerCode" type="xs:string" minOccurs="0"/>
            <!-- Цена за фасовку с учетом скидки -->
            <xs:element name="price" type="xs:decimal" minOccurs="1"/>       
            <!--
            Цена без НДС за фасовку с учетом скидки
            (только чтение)
            @since 6.2
            -->
            <xs:element name="priceWithoutVat" type="xs:decimal" minOccurs="0"/>
            <!-- Количество в базовых единицах измерения -->
            <xs:element name="amount" type="xs:decimal" minOccurs="1"/>
            <!--
            Cумма строки без учета скидки.
            Как правило sum == amount * price / container + discountSum + vatSum
             -->
            <xs:element name="sum" type="xs:decimal" minOccurs="1"/>
            <!-- Cумма скидки -->
            <xs:element name="discountSum" type="xs:decimal" minOccurs="0"/>
            <!--
            Величина процента НДС и сумма НДС для строки документа.
            Если не задана сумма, она вычисляется по проценту.
            Если не задан процент, он берется из карточки товара.
            Нельзя задать только сумму, не задавая процент.
            @since 5.0
             -->
            <xs:element name="vatPercent" type="xs:decimal" minOccurs="0"/>
            <xs:element name="vatSum" type="xs:decimal" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
 
    <xs:simpleType name="documentStatus">
        <xs:restriction base="xs:string">
            <xs:enumeration value="NEW"/>
            <xs:enumeration value="PROCESSED"/>
            <xs:enumeration value="DELETED"/>
        </xs:restriction>
    </xs:simpleType>
</xs:schema>
  

Что в ответе

Структура documentValidationResult

  

    [+]
    
      XSD Результат валидации документа​
    
  
  

    [-]
    
      XSD Результат валидации документа​
    
  
  

     
	
Copy Code
XML
	<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="documentValidationResult" type="documentValidationResult"/>
 
    <!--
    Результат валидации документа.
    Некоторые документы возвращают более подробную информацию, смотрите:
     * incomingInventoryValidationResult.xsd
    -->
    <xs:complexType name="documentValidationResult">
        <xs:sequence>
            <!-- Результат валидации. -->
            <xs:element name="valid" type="xs:boolean"/>
            <!-- Указывает на то, что ошибка не критичная и служит в качестве предупреждения. -->
            <xs:element name="warning" type="xs:boolean"/>
            <!-- Номер валидируемого документа. -->
            <xs:element name="documentNumber" type="xs:string" minOccurs="0"/>
            <!--
            Новый номер для документа.
            Отличен от null, если старый нарушает уникальность или не изменились влияющие на номер поля.
            -->
            <xs:element name="otherSuggestedNumber" type="xs:string" minOccurs="0"/>
            <!--
            Текст ошибки (или только заголовок, если задано additionalInfo).
            Предназначен для показа пользователю, но в REST API не всегда локализован.
            -->
            <xs:element name="errorMessage" type="xs:string" minOccurs="0"/>
            <!--
            Для невалидного результата может быть указана дополнительная информация, содержащая детали ошибки.
            Например, для случая списания в минус это поле содержит детальную информацию по каждой позиции документа,
            приводящей к отрицательным остаткам.
            -->
            <xs:element name="additionalInfo" type="xs:string" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
</xs:schema>
  

Пример запроса и результат

 

   Запрос 

   
	
Copy Code
XML
	<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <document>
        <id>1f959f26-c301-43b7-9999-eabf5fc1ce70</id>
        <documentNumber>21</documentNumber>
        <dateIncoming>2025-11-19T11:10:04.943+03:00</dateIncoming>
        <useDefaultDocumentTime>false</useDefaultDocumentTime>
        <status>PROCESSED</status>
        <accountToCode>5.01</accountToCode>
        <revenueAccountCode>4.01</revenueAccountCode>
        <defaultStoreId>1239d270-1bbe-f64f-b7ea-5f00518ef508</defaultStoreId>
        <defaultStoreCode>1</defaultStoreCode>
        <counteragentId>265aaefb-b984-cc76-0194-8427903c1a87</counteragentId>
        <counteragentCode></counteragentCode>
        <items>
            <item>
                <productId>f7179241-2bba-4efc-9ef7-cbb936292ed9</productId>
                <productArticle>00025</productArticle>
                <storeId>1239d270-1bbe-f64f-b7ea-5f00518ef508</storeId>
                <storeCode>1</storeCode>
                <price>50.000000000</price>
                <priceWithoutVat>50.000000000</priceWithoutVat>
                <amount>1.000000000</amount>
                <sum>50.000000000</sum>
                <discountSum>0.000000000</discountSum>
                <vatPercent>0.000000000</vatPercent>
                <vatSum>0.000000000</vatSum>
            </item>
        </items>
    </document> 

   Результат 

   
	
Copy Code
XML
	<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<documentValidationResult>
    <valid>true</valid>
    <warning>false</warning>
    <documentNumber>21</documentNumber>
</documentValidationResult>