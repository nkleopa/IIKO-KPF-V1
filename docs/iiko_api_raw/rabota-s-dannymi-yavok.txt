Работа с данными явок

  

    

  
Получение типов явок
Параметры запроса
Что в ответе
Пример запроса
Получение явок
Параметры запроса
Что в ответе
Создание или обновление явки
Что в ответе
Пример запроса
Удаление явки
Что в ответе
Пример вызова
Доступность сотрудников
Получить доступность сотрудников
Параметры запроса
Что в ответе
Пример вызова
Описание сущностей для представления в формате XML (XSD-схема) 

  
  

  

Получение типов явок

Версия API: 1.0
Версия iiko: 2.5
  
    
	
        
      	
        https://host:port/resto/api/employees/attendance/types
      
    
  

Параметры запроса

	Название
	Значение
	Версия
	Описание

	includeDeleted 	true\false	 	Включать ли удаленные элементы в результат. По умолчанию false.
	revisionFrom	
число, номер ревизии

	с 6.4	
Номер  ревизии, начиная с которой необходимо отфильтровать сущности. Не  включающий саму ревизию, т.е. ревизия объекта > revisionFrom.
По умолчанию (неревизионный запрос) revisionFrom = -1
Что в ответе

Возвращаются все не удаленные типы явок.
Пример запроса

https://localhost:8080/resto/api/employees/attendance/types
Получение явок

Версия API: 1.0
Версия iiko: 2.5        
	                	         https://host:port/resto/api/employees/attendance?from={YYYY-MM-DD}&to={YYYY-MM-DD}&withPaymentDetails={true/false}&revisionFrom=-1                        
	                	         https://host:port/resto/api/employees/attendance/byEmployee/{employeeUUID}/?from={YYYY-MM-DD}&to={YYYY-MM-DD}&withPaymentDetails={true/false}&revisionFrom=-1                        
	                	         https://host:port/resto/api/employees/attendance/byDepartment/{departmentCode}/?from={YYYY-MM-DD}&to={YYYY-MM-DD}&withPaymentDetails={true/false}&revisionFrom=-1                        
	                	         https://host:port/resto/api/employees/attendance/byDepartment/{departmentCode}/byEmployee/{employeeUUID}/?from={YYYY-MM-DD}&to={YYYY-MM-DD}&withPaymentDetails={true/false}&revisionFrom=-1                        
	                	         https://host:port/resto/api/employees/attendance/department/{departmentId}/?from={YYYY-MM-DD}&to={YYYY-MM-DD}&withPaymentDetails={true/false}&revisionFrom=-1                        
	                	         https://host:port/resto/api/employees/attendance/department/{departmentId}/byEmployee/{employeeUUID}/?from={YYYY-MM-DD}&to={YYYY-MM-DD}&withPaymentDetails={true/false}&revisionFrom=-1          
Параметры запроса

Параметр
Описание

	from
	дата начала отчета в формате YYYY-MM-DD

	to
	дата окончания отчета (включающая) в формате YYYY-MM-DD

	employeeUUID
	ID сотрудника

	departmentCode
	код подразделения (тот, который используется при регистрации iikoRMS в iikoChain)

	departmentId
	UUID идентификатор подразделения

	withPaymentDetails
	(начиная с 5.0) если true, ко сменам добавляется информация об отработанном времени и начисленной по явкам заработной плате.
У сотрудников, работающих по расписанию или на окладе, paymentDetails явки будет пуст.

	revisionFrom
	
номер ревизии, начиная с которой необходимо отфильтровать сущности.  Не включающий саму ревизию, т.е. ревизия объекта > revisionFrom.
По умолчанию (неревизионный запрос) revisionFrom = -1
Что в ответе

Возвращаются все явки, пересекающие интервал отчета.
При этом, в отличие от других методов API, здесь дата окончания выборки включающая: &to=2016-03-21 вернет явки, пересекающие 2016-03-22 00:00:00.
Пример запроса

https://localhost:8080/resto/api/employees/attendance?from=2017-08-01&to=2017-10-09&withPaymentDetails=true
Пример результата вызова API

	
Copy Code
Код
	<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<attendances>
    <attendance>
        <id>faa6d21e-7193-4c1f-885c-6049ddddd0ce</id>
        <employeeId>0a508f8c-4cdb-4126-bd0d-243c4718c22f</employeeId>
        <roleId>6e3fa11d-3617-c735-bd29-aeac662741ed</roleId>
        <dateFrom>2017-09-21T10:27:00+03:00</dateFrom>
        <attendanceType>W</attendanceType>
        <comment/>
        <departmentId>2b602c10-2045-4f52-b5f9-d00be812d6aa</departmentId>
        <departmentName>ТП1</departmentName>
        <paymentDetails>
            <regularPayedMinutes>0</regularPayedMinutes>
            <regularPaymentSum>0</regularPaymentSum>
            <overtimePayedMinutes>0</overtimePayedMinutes>
            <overtimePayedSum>0</overtimePayedSum>
            <otherPaymentsSum>0</otherPaymentsSum>
        </paymentDetails>
        <personalDateFrom>2017-09-21T10:27:00+03:00</personalDateFrom>
        <created>2017-09-21T10:27:53.987+03:00</created>
    </attendance>
    <attendance>
        <id>72582fa9-172b-4956-9b66-c3b40efff751</id>
        <employeeId>0a508f8c-4cdb-4126-bd0d-243c4718c22f</employeeId>
        <roleId>6e3fa11d-3617-c735-bd29-aeac662741ed</roleId>
        <dateFrom>2017-09-21T09:02:00+03:00</dateFrom>
        <dateTo>2017-09-21T14:02:00+03:00</dateTo>
        <attendanceType>W</attendanceType>
        <comment/>
        <departmentId>2b602c10-2045-4f52-b5f9-d00be812d6aa</departmentId>
        <departmentName>ТП1</departmentName>
        <paymentDetails>
            <regularPayedMinutes>300</regularPayedMinutes>
            <regularPaymentSum>50.000000000</regularPaymentSum>
            <overtimePayedMinutes>0</overtimePayedMinutes>
            <overtimePayedSum>0</overtimePayedSum>
            <otherPaymentsSum>0</otherPaymentsSum>
        </paymentDetails>
        <personalDateFrom>2017-09-21T09:02:00+03:00</personalDateFrom>
        <created>2017-09-21T09:02:40.343+03:00</created>
        <modified>2017-09-21T10:17:06.620+03:00</modified>
        <userModified>c831367e-778f-e80f-18f7-bd0843cd10c6</userModified>
    </attendance>
</attendances>

Создание или обновление явки

Версия API: 1.0
Версия iiko: 2.5
  
    
	
        
      	
        https://host:port/resto/api/employees/attendance/create
      
    
  

        
	                	         https://host:port/resto/api/employees/attendance/update                

Структура attendance: при создании поле id может быть не заполнено. Даты округляются с точностью до минуты. Запрещается создание пересекающихся явок.

Что в ответе

Структура attendance после сохранения, с округленными датами, сгенерированным id.
Внимание! При обновлении (update) явки ее id может измениться.
Пример запроса

https://localhost:8080/resto/api/employees/attendance/create
Пример результата вызова API

	
Copy Code
Код
	<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<attendance>
    <id>d9d8aa67-9e10-97ee-015e-f1879f9c5e87</id>
    <employeeId>0a508f8c-4cdb-4126-bd0d-243c4718c22f</employeeId>
    <roleId>6e3fa11d-3617-c735-bd29-aeac662741ed</roleId>
    <dateFrom>2017-10-08T10:00:00+03:00</dateFrom>
    <dateTo>2017-10-08T18:00:00+03:00</dateTo>
    <attendanceType>W</attendanceType>
    <comment/>
    <departmentId>2b602c10-2045-4f52-b5f9-d00be812d6aa</departmentId>
    <departmentName>ТП1</departmentName>
    <personalDateFrom>2017-10-08T18:00:00+03:00</personalDateFrom>
    <created>2017-10-09T09:26:22.731+03:00</created>
    <modified>2017-10-09T09:26:22.731+03:00</modified>
    <userModified>c831367e-778f-e80f-18f7-bd0843cd10c6</userModified>
</attendance>

Удаление явки

Версия API: 1.0
Версия iiko: 5.0
  
    
	
        
      	
        https://host:port/resto/api/employees/attendance/byId/{attendanceUUID}
      
    
  

Что в ответе

Удаленная явка attendance.
Пример вызова

https://localhost:8080/resto/api/employees/attendance/byId/d9d8aa67-9e10-97ee-015e-f1879f9c5e87 

Доступность сотрудников

Получить доступность сотрудников

Версия API: 1.0
Версия iiko: 5.0
  
    
	
        
      	
        https://host:port/resto/api/employees/availability/list?from={YYYY-MM-DD}&to={YYYY-MM-DD}&department={departmentUUID}&role={roleUUID}&user={userUUID}
      
    
  

Параметры запроса

	Параметр
	Описание

	from	Дата начала отчета (включающая).
	to	
Дата окончания отчета (исключающая).
Внимание!  Отрезки доступности будут сформированы по расписаниям на весь  запрошенный интервал, то есть, следует использовать минимально  необходимую дату (неделя/месяц вперед).
	department	Id подразделения сотрудника для фильтрации. Можно задать параметр несколько раз. Если не задан ни один, отображаются данные по сотрудникам всех подразделений.
	role	Id  должности сотрудника для фильтрации. Можно задать параметр несколько  раз. Если не задан ни один, отображаются данные по сотрудникам всех  должностей.
	user	Id сотрудника для фильтрации. Можно задать параметр несколько раз. Если не задан, отображаются данные по всем сотрудникам.
Что в ответе

Список отрезков доступности availability.
Пример вызова

https://localhost:8080/resto/api/employees/availability/list?from=2017-09-01&to=2017-10-09&department=2b602c10-2045-4f52-b5f9-d00be812d6aa&role=6e3fa11d-3617-c735-bd29-aeac662741ed&user=0a508f8c-4cdb-4126-bd0d-243c4718c22f
Пример результата вызова API

	
Copy Code
Код
	 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<availabilities>
    <availability>
        <employeeId>0a508f8c-4cdb-4126-bd0d-243c4718c22f</employeeId>
        <dateFrom>2017-09-01T00:00:00+03:00</dateFrom>
        <dateTo>2017-10-09T00:00:00+03:00</dateTo>
    </availability>
</availabilities>

Описание сущностей для представления в формате XML (XSD-схема)

  

    [+]
    
      Явки
    
  
  

    [-]
    
      Явки
    
  
  

     
	
Copy Code
XML
	<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
 
    <xs:complexType name="attendance">
        <xs:sequence>
            <!--
            При редактировании явки через API ее id может измениться, в частности при смене ее подразделения.
            При создании явки id можно не указывать.
            since 5.0
            -->
            <xs:element name="id" type="xs:string"/>
            <xs:element name="employeeId" type="xs:string"/>
            <!--
            Должность, в которой работал сотрудник. У старых явок может быть null.
            При импорте, если не указано, используется основная должность сотрудника на дату явки.
            since 5.0
            -->
            <xs:element name="roleId" type="xs:string" minOccurs="0"/>
            <xs:element name="attendanceTypeId" type="xs:string" minOccurs="0"/>
            <xs:element name="attendanceType" type="xs:string" minOccurs="0"/>
            <xs:element name="comment" type="xs:string" minOccurs="0"/>
            <!-- Время начала подтверждённой явки -->
            <xs:element name="dateFrom" type="xs:dateTime" minOccurs="0"/>
            <!-- Время окончания подтверждённой явки -->
            <xs:element name="dateTo" type="xs:dateTime" minOccurs="0"/>
            <!--
            Время начала персональной явки с iikoFront.
            Отсутствует, если явку создали в iikoOffice.
            При редактировании, если null или не задано, старое значение не изменяется.
            since 5.0
            -->
            <xs:element name="personalDateFrom" type="xs:dateTime" minOccurs="0"/>
            <!--
            Время окончания персональной явки с iikoFront.
            Отсутствует, если явку создали в iikoOffice.
            Отсутствует, если явка не закрыта.
            При редактировании, если null или не задано, старое значение не изменяется.
            since 5.0
            -->
            <xs:element name="personalDateTo" type="xs:dateTime" minOccurs="0"/>
            <!--
            Подразделение, в котором произошла явка.
            since 4.4
            -->
            <xs:element name="departmentId" type="xs:string" minOccurs="1"/>
            <!--
            Название подразделения, в котором произошла явка.
            since 4.4
            -->
            <xs:element name="departmentName" type="xs:string" minOccurs="1"/>
            <!--
            Данные о начислениях заработной платы, связанных с данной сменой.
            Доступны только на чтение и только при указании withPaymentDetails=true.
            Заполняется только для явок по должностям со свободным графиком.
            since 5.0
            -->
            <xs:element name="paymentDetails" type="paymentDetails" minOccurs="0"/>
            <!--
            Дата создания. При импорте игнорируется.
            since 5.0
            -->
            <xs:element name="created" type="xs:dateTime" minOccurs="0"/>
            <!--
            Дата последней правки. При импорте игнорируется.
            since 5.0
            -->
            <xs:element name="modified" type="xs:dateTime" minOccurs="0"/>
            <!--
            Автор последней правки. При импорте игнорируется.
            since 5.0
            -->
            <xs:element name="userModified" type="xs:string" minOccurs="0"/>
        </xs:sequence>
    </xs:complexType>
 
    <!--
    Зачтенное отработанное время в минутах и начисленная за смену или явку заработная плата.
    При работе по свободному графику заполняется только у явок.
    При работе по сменному или окладному графику заполняется только у смен.
    У смен делится на основную (regular) и переработку (overtime) по флагу overtime типа смены (ScheduleType).
    У явок в текущей реализации все попадает в regular, но это может измениться в следующих версиях.
    -->
    <xs:complexType name="paymentDetails">
        <xs:sequence>
            <!--
            Id и название подразделения, в котором начислена заработная плата.
            Может отличаться от подразделения, где была назначена смена и произошла явка.
            -->
            <xs:element name="salaryDepartmentId" type="xs:string" minOccurs="1"/>
            <xs:element name="salaryDepartmentName" type="xs:string" minOccurs="1"/>
            <!-- Зачтенное отработанное время в минутах. -->
            <xs:element name="regularPayedMinutes" type="xs:int" minOccurs="1"/>
            <!-- Начисленная за смену или явку заработная плата. -->
            <xs:element name="regularPaymentSum" type="xs:decimal" minOccurs="1"/>
            <!-- Зачтенное время переработки. -->
            <xs:element name="overtimePayedMinutes" type="xs:int" minOccurs="1"/>
            <!-- Начисленная за переработку заработная плата. -->
            <xs:element name="overtimePaymentSum" type="xs:decimal" minOccurs="1"/>
            <!--
            Общая сумма начисленных и не отмененных автоматических штрафов за нарушение расписания
            (пропуск смены, ранний уход, опоздание, и т.п.).
            В текущей реализации отрицательна или равна нулю, и заполнена только у смены.
            -->
            <xs:element name="otherPaymentsSum" type="xs:decimal" minOccurs="1"/>
        </xs:sequence>
    </xs:complexType>
</xs:schema>
  

  

  

    [+]
    
      Тип явки
    
  
  

    [-]
    
      Тип явки
    
  
  

     
	
Copy Code
XML
	<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">

  <xs:element name="attendanceType" type="attendanceType"/>

  <xs:complexType name="attendanceType">
    <xs:sequence>
      <xs:element name="code" type="xs:string"/>
      <xs:element name="comment" type="xs:decimal" minOccurs="0"/>
      <xs:element name="id" type="xs:string"/>
      <xs:element name="name" type="xs:string"/>
      <xs:element name="payRate" type="xs:decimal" default="1" minOccurs="0"/>
      <xs:element name="status" type="xs:boolean"/>
    </xs:sequence>
  </xs:complexType>
</xs:schema>