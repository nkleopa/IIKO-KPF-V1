Работа с приказами

  

    

  
API приказов
MenuChangeDocumentDto
MenuChangeDocumentItemDto
IncludeForCategoryDto
PriceForCategoryDto
Выгрузка приказов
Параметры запроса
Что в ответе
Пример запроса и результата
Выгрузка приказа по идентификатору
Параметры запроса
Пример запроса и результата
Выгрузка приказов по номеру
Параметры запроса
Пример запроса и результат
Создание/редактирование приказа
Тело запроса
Пример 

  
Цены, заданные приказами 
  

  

  API приказов

  Версия iiko: 7.8

  Описание полей

  MenuChangeDocumentDto

  
    
      
      
      
    
    
      

        
          

            Поле
          
        
        
          

            Тип
          
        
        
          

            Описание
          
        
      
    
    
      

        	
          id
        
        	
          UUID
        
        	
          Идентификатор.
        
      
      

        	
          dateIncoming
        
        	
          String
        
        	
          Дата проведения документа (учетная) в формате "yyyy-MM-dd".
        
      
      

        	
          documentNumber
        
        	
          String
        
        	
          Учетный номер документа.
        
      
      

        	
          status
        
        	
          Enum
        
        	
          

            Статус документа.
          
          

            
              
                

                  
                    

                      Значение
                    
                  
                  
                    

                      Описание
                    
                  
                
              
              
                

                  	
                    NEW
                  
                  	
                    Новый.
                  
                
                

                  	
                    PROCESSED
                  
                  	
                    Проведенный.
                  
                
                

                  	
                    DELETED
                  
                  	
                    Удаленный.
                  
                
              
            
          
        
      
      

        	
          comment
        
        	
          String
        
        	
          Комментарий к документу.
        
      
      

        	
          shortName
        
        	
          String
        
        	
          Короткое название приказа для отображения на кнопках фронта.
        
      
      

        	
          deletePreviousMenu
        
        	
          Boolean
        
        	
          Если true, то те блюда, которые не присутствуют в документе, будут исключены из меню.
        
      
      

        	
          scheduleId
        
        	
          UUID
        
        	
          Идентификатор расписания. Задается пользователем при создании/редактировании приказа по времени.
        
      
      

        	
          schedule
        
        	
          PeriodScheduleDto
        
        	
          Расписание действия приказа по времени. Только чтение.
        
      
      

        	
          dateTo
        
        	
          String
        
        	
          Дата окончания действия (отмены) приказа в формате "yyyy-MM-dd".
        
      
      

        	
          items
        
        	
          List<MenuChangeDocumentItemDto>
        
        	
          Позиции приказа.
        
      
    
  

  MenuChangeDocumentItemDto

  
    
      
      
      
    
    
      

        
          

            Поле
          
        
        
          

            Тип
          
        
        
          

            Описание
          
        
      
    
    
      

        	
          num
        
        	
          Integer
        
        	
          

            Позиция строки в документе. При создании/редактировании приказа не учитывается.
          
        
      
      

        	
          departmentId
        
        	
          UUID
        
        	
          Идентификатор департамента, в котором осуществляется продажа данного продукта.
        
      
      

        	
          productId
        
        	
          UUID
        
        	
          Идентификатор продукта.
        
      
      

        	
          productSizeId
        
        	
          UUID
        
        	
          Идентификатор размера продукта.
        
      
      

        	
          including
        
        	
          Boolean
        
        	
          Включен ли продукт в прайс-лист.
        
      
      

        	
          price
        
        	
          BigDecimal
        
        	
          Цена.
        
      
      

        	
          dishOfDay
        
        	
          Boolean
        
        	
          Является ли блюдо хитом.
        
      
      

        	
          flyerProgram
        
        	
          Boolean
        
        	
          Участвует ли блюдо во флаерной программе.
        
      
      

        	
          includeForCategories
        
        	
          List<IncludeForCategoryDto>
        
        	
          Если в этом списке присутствует идентификатор категории, то для данной ценовой категории есть своя специфика ценообразования.
        
      
      

        	
          pricesForCategories
        
        	
          List<PriceForCategoryDto>
        
        	
          Цены для категорий.
        
      
    
  

  IncludeForCategoryDto

  
    
      
      
      
    
    
      

        
          

            Поле
          
        
        
          

            Тип
          
        
        
          

             Описание
          
        
      
    
    
      

        	
          categoryId
        
        	
          UUID
        
        	
          Идентификатор ценовой категории.
        
      
      

        	
          include
        
        	
          Boolean
        
        	
          Если true, то цену берем из PriceForCategoryDto, если false, то для данной ценовой категории данный продукт исключен из прайс-листа.
        
      
    
  

  PriceForCategoryDto

  
    
      
      
      
    
    
      

        
          

            Поле
          
        
        
          

            Тип
          
        
        
          

            Описание
          
        
      
    
    
      

        	
          categoryId
        
        	
          UUID
        
        	
          Идентификатор ценовой категории.
        
      
      

        	
          price
        
        	
          BigDecimal
        
        	
          Цена.
        
      
    
  

Выгрузка приказов

  
    
	
        
      	https://host:port/resto/api/v2/documents/menuChange
    
  

Параметры запроса

            
              
                

                  
                    

                      Параметр
                    
                  
                  
                    

                      Тип
                    
                  
                  
                    

                      Описание
                    
                  
                
              
              
                

                  	
                    dateFrom
                  
                  	
                    String
                  
                  	
                    Начало временного интервала в формате "yyyy-MM-dd". Обязательный.
                  
                
                

                  	
                    dateTo
                  
                  	
                    String
                  
                  	
                    Конец временного интервала в формате "yyyy-MM-dd". Обязательный.
                  
                
                

                  	
                    status
                  
                  	
                    Enum
                  
                  	
                    Статус документа. Если не задан, то все.
                  
                
                

                  	
                    revisionFrom
                  
                  	
                    Integer
                  
                  	
                    В ответе будут сущности с ревизией выше данной. По умолчанию '-1'.
                  
                
              
            
          
Что в ответе

          

            Список приказов.
          
          

            Поле revision - максимальная ревизия, доступная для выгрузки во внешние системы на момент запроса (это значит, что в базе присутствуют записи с такой ревизией, а записей с ревизией выше этой в базе нет).
          
          

            Эту ревизию можно использовать в качестве параметра revisionFrom в следующем запросе на получение списка расписаний.
          
        
Пример запроса и результата

Запрос

https://localhost:8080/resto/api/v2/documents/menuChange?dateFrom=2021-08-01&dateTo=2021-09-31

  

    [+]
    
      Результат
    
  
  

    [-]
    
     Результат
    
  
  

     
	
Copy Code
JSON
	{
  "result": "SUCCESS",
  "errors": [
  ],
  "response": [
    {
      "id": "d57dfa32-7e4a-446c-b2e4-e28e065b2112",
      "dateIncoming": "2021-08-01",
      "documentNumber": "0005",
      "status": "PROCESSED",
      "shortName": "",
      "deletePreviousMenu": false,
      "schedule": {
        "id": "598ce53a-c49c-4cd5-8248-1e2b4f0994cf",
        "name": "Рабочий полдник",
        "periods": [
          {
            "begin": "16:00",
            "end": "17:00",
            "daysOfWeek": [
              1,
              2,
              3,
              4,
              5                                                            
            ]
            
          }
          
        ]
        
      },
      "dateTo": "2500-01-01",
      "items": [
        {
          "num": 0,
          "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
          "productId": "a00a470c-6cc9-4b7f-835f-393e41af8fcf",
          "productSizeId": "e4a246af-d94f-4505-ae2e-7bc854e6908a",
          "including": false,
          "price": 0,
          "dishOfDay": false,
          "flyerProgram": true,
          "pricesForCategories": [
            {
              "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
              "price": 0                                                            
            },
            {
              "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
              "price": 100                                                            
            }
            
          ],
          "includeForCategories": [
            {
              "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
              "include": true                                                            
            },
            {
              "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
              "include": true                                                            
            }
            
          ]
          
        },
        {
          "num": 1,
          "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
          "productId": "4a5e8eea-8d6a-44f9-a72d-db834d666cf2",
          "productSizeId": null,
          "including": false,
          "price": 0,
          "dishOfDay": false,
          "flyerProgram": true,
          "pricesForCategories": [
            {
              "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
              "price": 0                                                            
            },
            {
              "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
              "price": 13                                                            
            }
            
          ],
          "includeForCategories": [
            {
              "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
              "include": true                                                            
            },
            {
              "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
              "include": true                                                            
            }
            
          ]
          
        }
        
      ]
      
    },
    {
      "id": "d776601c-3184-40d0-8d90-e0cd2164801a",
      "dateIncoming": "2021-09-01",
      "documentNumber": "0006",
      "status": "NEW",
      "shortName": "",
      "deletePreviousMenu": false,
      "dateTo": "2500-01-01",
      "items": [
        {
          "num": 0,
          "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
          "productId": "8d291bb4-1464-4aa9-b375-318e257deca8",
          "productSizeId": null,
          "including": true,
          "price": 107,
          "dishOfDay": false,
          "flyerProgram": false,
          "pricesForCategories": [
          ],
          "includeForCategories": [
          ]                                                    
        }
        
      ]
      
    },
    {
      "id": "02555110-7076-4af8-8f53-3a2c628804fd",
      "dateIncoming": "2021-09-01",
      "documentNumber": "0007",
      "status": "NEW",
      "shortName": "",
      "deletePreviousMenu": false,
      "dateTo": "2500-01-01",
      "items": [
        {
          "num": 0,
          "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
          "productId": "8d291bb4-1464-4aa9-b375-318e257deca8",
          "productSizeId": null,
          "including": false,
          "price": 0,
          "dishOfDay": false,
          "flyerProgram": false,
          "pricesForCategories": [
          ],
          "includeForCategories": [
            {
              "categoryId": "95035a38-cd23-4b3b-92d8-1db673b6848f",
              "include": false                                                            
            }
            
          ]
          
        }
        
      ]
      
    }
    
  ],
  "revision": 187706                                    
}
  

   Выгрузка приказа по идентификатору

        
	                	https://host:port/resto/api/v2/documents/menuChange/byId         
Параметры запроса

          

            
              
                

                  
                    

                      Параметр
                    
                  
                  
                    

                      Тип
                    
                  
                  
                    

                      Описание
                    
                  
                
              
              
                

                  	
                    id
                  
                  	
                    UUID
                  
                  	
                    Идентификатор приказа.
                  
                
              
            
          
        
Пример запроса и результата

Запрос

https://localhost:8080/resto/api/v2/documents/menuChange/byId?id=d776601c-3184-40d0-8d90-e0cd2164801a

  

    [+]
    
      Результат
    
  
  

    [-]
    
     Результат
    
  
  

     
	
Copy Code
JSON
	{
  "id": "d776601c-3184-40d0-8d90-e0cd2164801a",
  "dateIncoming": "2021-09-01",
  "documentNumber": "0006",
  "status": "NEW",
  "shortName": "",
  "deletePreviousMenu": false,
  "dateTo": "2500-01-01",
  "items": [
    {
      "num": 0,
      "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
      "productId": "8d291bb4-1464-4aa9-b375-318e257deca8",
      "productSizeId": null,
      "including": true,
      "price": 107,
      "dishOfDay": false,
      "flyerProgram": false,
      "pricesForCategories": [
      ],
      "includeForCategories": [
      ]                                            
    }
    
  ]
  
}
  

   Выгрузка приказов по номеру

        
	                	https://host:port/resto/api/v2/documents/menuChange/byNumber         
Параметры запроса

          

            
              
                

                  
                    

                      Параметр
                    
                  
                  
                    

                      Тип
                    
                  
                  
                    

                      Описание
                    
                  
                
              
              
                

                  	
                    documentNumber
                  
                  	
                    String
                  
                  	
                    Номер документа.
                  
                
              
            
          
        

Пример запроса и результат

Запрос 

https://localhost:8080/resto/api/v2/documents/menuChange/byNumber?documentNumber=0006

  

    [+]
    
      Результат
    
  
  

    [-]
    
     Результат
    
  
  

     
	
Copy Code
JSON
	[
  {
    "id": "d776601c-3184-40d0-8d90-e0cd2164801a",
    "dateIncoming": "2021-09-01",
    "documentNumber": "0006",
    "status": "NEW",
    "shortName": "",
    "deletePreviousMenu": false,
    "dateTo": "2500-01-01",
    "items": [
      {
        "num": 0,
        "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
        "productId": "8d291bb4-1464-4aa9-b375-318e257deca8",
        "productSizeId": null,
        "including": true,
        "price": 107,
        "dishOfDay": false,
        "flyerProgram": false,
        "pricesForCategories": [
        ],
        "includeForCategories": [
        ]                                                
      }
      
    ]
    
  }
  
]
  

Создание/редактирование приказа

  
    
	
        
      	
        
https://host:port/resto/api/v2/documents/menuChange
      
    
  

Тело запроса

            

              См. MenuChangeDocumentDto.
            
            

              Если идентификатор документа не задан, то это создание нового приказа.
            
            

              Если идентификатор документа задан, то это редактирование приказа.
            
            

              Редактировать приказ можно, если
            
            
              

                он находится в статусе 'NEW'
              
              

                он находится в статуе 'PROCESSED' и дата проведения (начала действия) приказа сегодня или позже
              
            
            

              У  приказа в статусе 'PROCESSED', дата проведения которого вчера или  ранее, можно изменить только дату окончания, если дата окончания завтра  или позже.
            
            

              Редактировать НК в приказе (поля taxCategoryId и taxCategoryEnabled) можно только при наличии лицензионного модуля  'Возможность задавать налоговую категорию в приказах на изменение меню' (ModuleId = 21052802).             
            

              Если явно задать taxCategoryEnabled при отключенной лицензии, то значения полей taxCategoryId и taxCategoryEnabled будут проигнорированы, 
            в БД значения этих полей не изменятся, в серверный лог будет выведено предупреждение вида:
            
The licensing module TAXCATEGORY_IN_PRICECHANGEORDER is not present or expired. Failed to establish tax category TaxCategory[ade0e464-0651-459b-ab14-12bab1570983]@80623417,r124 '20' for product товар_2 (GOODS), produceSize null, department Department[0226a08b-b08d-428d-a505-f9a0de024373]@1330525574,r27 {code: 1, 'Новое торг. предприятие'}, date Wed Jul 12 00:00:00 MSK 2023
            

              Если не задавать явно taxCategoryEnabled, как это делают старые интеграции, которые ничего не знают про поля НК/Включить НК, 
            
            

              то в БД значения этих полей не изменятся. Наличие лицензии в этом случае не проверяется.
            
            

              Пример
            

              https://localhost:8080/resto/api/v2/documents/menuChange
            

  

    [+]
    
      Запрос
    
  
  

    [-]
    
      Запрос
    
  
  

     
	
Copy Code
JSON
	{
  "dateIncoming": "2021-10-01",
  "documentNumber": "0007",
  "status": "PROCESSED",
  "shortName": "",
  "deletePreviousMenu": false,
  "dateTo": "2021-10-30",
  "items": [
    {
      "num": 0,
      "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
      "productId": "8d291bb4-1464-4aa9-b375-318e257deca8",
      "productSizeId": null,
      "including": true,
      "price": 0,
      "pricesForCategories": [
        {
          "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
          "price": 100                                                                            
        },
        {
          "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
          "price": 0                                                                            
        }
        
      ],
      "includeForCategories": [
        {
          "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
          "include": true                                                                            
        },
        {
          "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
          "include": true                                                                            
        }
        
      ],
      "flyerProgram": false,
      "dishOfDay": false                                                                    
    }
    
  ]
  
}
  

  

    [+]
    
      Результат
    
  
  

    [-]
    
     Результат
    
  
  

     
	
Copy Code
JSON
	{
  "result": "SUCCESS",
  "errors": [
  ],
  "response": {
    "id": "6ef79116-ed49-81e2-017b-df0b7c360030",
    "dateIncoming": "2021-10-01",
    "documentNumber": "0007",
    "status": "PROCESSED",
    "shortName": "",
    "deletePreviousMenu": false,
    "dateTo": "2021-10-30",
    "items": [
      {
        "num": 0,
        "departmentId": "6713a472-973e-4215-8e0f-e3142945befd",
        "productId": "8d291bb4-1464-4aa9-b375-318e257deca8",
        "productSizeId": null,
        "including": true,
        "price": 0,
        "dishOfDay": false,
        "flyerProgram": false,
        "pricesForCategories": [
          {
            "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
            "price": 100                                                                                
          },
          {
            "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
            "price": 0                                                                                
          }
          
        ],
        "includeForCategories": [
          {
            "categoryId": "67a54111-99ff-40cc-9f34-f2feddd0ff2b",
            "include": true                                                                                
          },
          {
            "categoryId": "515d91b3-f4e3-46fa-abc2-de7567df95c9",
            "include": true                                                                                
          }
          
        ]
        
      }
      
    ]
    
  }
  
}